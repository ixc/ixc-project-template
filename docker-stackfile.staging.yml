# Save as `docker-stackfile.{environment}.yml`. Do not commit secrets.
# Always pin images for linked services on production environments.
django:
  autoredeploy: true
  deployment_strategy: high_availability
  environment:
    BASE_SETTINGS_MODULE: staging
    EMAIL_HOST_PASSWORD:
    # MASTER_PASSWORD:
    MEDIA_AWS_SECRET_ACCESS_KEY:
    # PGDATABASE:
    PGHOST: staging.cu6ofenwuorn.ap-southeast-2.rds.amazonaws.com
    PGPASSWORD:
    # PGPORT:
    PGUSER: staging
    SENTRY_DSN:
    SRC_PGDATABASE:
    # SRC_PGHOST:
    # SRC_PGPASSWORD:
    # SRC_PGPORT:
    # SRC_PGUSER:
    VIRTUAL_HOST: {{ project_name }}.stg.ixcsandbox.com
  image: interaction/{{ project_name }}:staging
  links:
    - elasticsearch
    # - postgres
    - redis
  ports:
    - "8000"
  restart: on-failure
  sequential_deployment: true  # Avoid parallel execution of `migrate` command
  tags:
    - staging
  volumes:
    - /opt/{{ project_name }}/var
elasticsearch:
  image: interaction/elasticsearch-icu:1
  restart: on-failure
  tags:
    - staging
# haproxy:
#   environment:
#     HTTP_BASIC_AUTH: USERNAME:PASSWORD
#   image: dockercloud/haproxy:latest
#   links:
#     - django
#   ports:
#     - "80:80"
#   roles:
#     - global
#   restart: on-failure
#   tags:
#     - {environment}
# postgres:
#   environment:
#     POSTGRES_PASSWORD:
#   image: postgres:9.4
#   restart: on-failure
#   tags:
#     - {environment}
redis:
  image: redis:3
  restart: on-failure
  tags:
    - staging
